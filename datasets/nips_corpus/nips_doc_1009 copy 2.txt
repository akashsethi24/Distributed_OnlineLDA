Factorial Hidden Markov Models 
Zoubin Ghahramani 
zoubin@psyche.mit.edu 
Department of Computer Science 
University of Toronto 
Toronto, ON M5S 1A4 
Canada 
Michael I. Jordan 
jordan@psyche.mit.edu 
Department of Brain & Cognitive Sciences 
Massachusetts Institute of Technology 
Cambridge, MA 02139 
USA 
Abstract 
We present a framework for learning in hidden Markov models with 
distributed state representations. Within this framework, we de- 
rive a learning algorithm based on the Expectation-Maximization 
(EM) procedure for maximum likelihood estimation. Analogous to 
the standard Baum-Welch update rules, the M-step of our algo- 
rithm is exact and can be solved analytically. However, due to the 
combinatorial nature of the hidden state representation, the exact 
E-step is intractable. A simple and tractable mean field approxima- 
tion is derived. Empirical results on a set of problems suggest that 
both the mean field approximation and Gibbs sampling are viable 
alternatives to the computationally expensive exact algorithm. 
I Introduction 
A problem of fundamental interest to machine learning is time series modeling. Due 
to the simplicity and efficiency of its parameter estimation algorithm, the hidden 
Markov model (HMM) has emerged as one of the basic statistical tools for modeling 
discrete time series, finding widespread application in the areas of speech recogni- 
tion (Rabiner and Juang, 1986) and computational molecular biology (Baldi et al., 
1994). An HMM is essentially a mixture model, encoding information about the 
history of a time series in the value of a single multinomial variable (the hidden 
state). This multinomial assumption allows an efficient parameter estimation algo- 
rithm to be derived (the Baum-Welch algorithm). However, it also severely limits 
the representational capacity of HMMs. For example, to represent 30 bits of in- 
formation about the history of a time sequence, an HMM would need 23� distinct 
states. On the other hand an HMM with a distributed state representation could 
achieve the same task with 30 binary units (Williams and Hinton, 1991). This paper 
addresses the problem of deriving efficient learning algorithms for hidden Markov 
models with distributed state representations. 
Factorial Hidden Markov Models 4 73 
The need for distributed state representations in HMMs can be motivated in two 
ways. First, such representations allow the state space to be decomposed into 
features that naturally decouple the dynamics of a single process generating the 
time series. Second, distributed state representations simplify the task of modeling 
time series generated by the interaction of multiple independent processes. For 
example, a speech signal generated by the superposition of multiple simultaneous 
speakers can be potentially modeled with such an architecture. 
Williams and Hinton (1991) first formulated the problem of learning in HMMs with 
distributed state representation and proposed a solution based on deterministic 
Boltzmann learning. The approach presented in this paper is similar to Williams 
and Hinton's in that it is also based on a statistical mechanical formulation of hidden 
Markov models. However, our learning algorithm is quite different in that it makes 
use of the special structure of HMMs with distributed state representation, resulting 
in a more efficient learning procedure. Anticipating the results in section 2, this 
learning algorithm both obviates the need for the two-phase procedure of Boltzmann 
machines, and has an exact M-step. A different approach comes from Saul and 
Jordan (1995), who derived a set of rules for computing the gradients required for 
learning in HMMs with distributed state spaces. However, their methods can only 
be applied to a limited class of architectures. 
2 Factorial hidden Markov models 
Hidden Markov models are a generalization of mixture models. At any time step, 
the probability density over the observables defined by an HMM is a mixture of 
the densities defined by each state in the underlying Markov model. Temporal 
dependencies are introduced by specifying that the prior probability of the state at 
time t depends on the state at time t- 1 through a transition matrix, P (Figure la). 
Another generalization of mixture models, the cooperative vector quantizer (CVQ; 
Hinton and Zemel, 1994 ), provides a natural formalism for distributed state repre- 
sentations in HMMs. Whereas in simple mixture models each data point must be 
accounted for by a single mixture component, in CVQs each data point is accounted 
for by the combination of contributions from many mixture components, one from 
each separate vector quantizer. The total probability density modeled by a CVQ 
is also a mixture model; however this mixture density is assumed to factorize into 
a product of densities, each density associated with one of the vector quantizers. 
Thus, the CVQ is a mixture model with distributed representations for the mixture 
components. 
Factorial hidden Markov models 1 combine the state transition structure of HMMs 
with the distributed representations of CVQs (Figure lb). Each of the d underlying 
t at time t and transition probability matrix 
Markov models has a discrete state s i 
Pi. As in the CVQ, the states are mutually exclusive within each vector quantizer 
and we assume real-valued outputs. The sequence of observable output vectors is 
generated from a normal distribution with mean given by the weighted combination 
of the states of the underlying Markov models: 
i=1 
where C is a common covariance matrix. The k-valued states si are represented as 
We refer to HMMs with distributed state as factorial HMMs as the features of the 
distributed state factorize the total state representation. 
4 74 Z. GHAHRAMANI, M. I. JORDAN 
discrete column vectors with a 1 in one position and 0 everywhere else; the mean of 
the observable is therefore a combination of columns from each of the Wi matrices. 
a) 
(ooooo) 
P 
b) 
(ooooo) � 
) 
Figure 1. a) Hidden Markov model. b) Factorial hidden Markov model. 
We capture the above probability model by defining the energy of a sequence of T 
states and observations, {(st, yt)}tT= , which we abbreviate to {s,y}, as: 
yt _ y Vis C -1 
7/({s,y}) -  t--1 i----1 
-- -- S i Ais i , (1) 
i=1 t=l i=1 
= sit ) such that Ej-1 e[A ---- 1 and denotes matrix 
where [Ai]t logP(sjl t--1 k 
transpose. Priors for the initial state, s 1, are introduced by setting the second term 
I 
in (1) to --]-{=1 si logTri. The probability model is defined from this energy by 
the Boltzmann distribution 
1 exp{-7t({s, y}) }. 
P({s,y}) =  
(2) 
Note that like in the CVQ (Ghahramani, 1995), the unclamped partition function 
Z - / d{y) y.exp{-7/({s, y})), 
{s} 
evaluates to a constant, independent of the parameters. This can be shown by 
first integrating the Gaussian variables, removing all dependency on {y}, and then 
summing over the states using the constraint on e[A'] . 
The EM algorithm for Factorial HMMs 
As in HMMs, the parameters of a factoriM HMM can be estimated via the EM 
(Baum-Welch) algorithm. This procedure iterates between assuming the current 
parameters to compute probabilities over the hidden states (E-step), and using 
these probabilities to maximize the expected log likelihood of the parameters (M- 
step). 
Using the likelihood (2), the expected log likelihood of the parameters is 
Q(n'l ) = (-7/({s, y)) -logZ)c, (3) 
Factoffal Hidden Markov Models 4 75 
where ( -- {Wi,Pi, C)id__l denotes the current parameters, and (. denotes ex- 
pectation given the clamped observation sequence and b. Given the observation 
sequence, the only random variables are the hidden states� Expanding equation (3) 
and limiting the expectation to these random variables we find that the statistics 
t t t t t t-1 t 
that need to be computed for the E-step are (si)c, ($i$j)c, and ($i$i )c. Note 
that in standard HMM notation (Rabiner and Juang, 1986), (s)c corresponds to 
7t and t t--i t t 
(s,s, corresponds to 6, where no analogue when there 
is only a single underlying Markov model. The M-step uses these expectations to 
maximize Q with respect to the parameters. 
The constant partition function allowed us to drop the second term in (3). There- 
fore, unlike the Boltzmann machine, the expected log likelihood does not depend 
on statistics collected in an unclamped phase of learning, resulting in much faster 
learning than the traditional Boltzmann machine (Neal, 1992). 
M-step 
Setting the derivatives of Q with respect to the output weights to zero, we obtain 
a linear system of equations for W: 
t 
N,t j 
wnew= 
L ]V,t . 
the vector and 
where s and W are matrix of concatenated si and. Wi, 
respectively,-. N denotes summation over a data set of N sequences, and i is the 
Moore-Penrose pseudo-inverse. To estimate the log transition probabilities we solve 
� [A,b, 
OQ/O[Ai]jt - 0 subject to the constraint .j e ' - 1, obtaining 
[A ]new EN, t(8J 8il 1)c 
t i./t - log (4) 
- 1st t- ' 
Z-N,t,jk ijSil 1) c 
The covariance matrix can be similarly estimated: 
anew .-- Eyy'- E y(S)'c(SS')(s)cy'. 
N,t N,t 
The M-step equations can therefore be solved analytically; furthermore, for a single 
underlying Markov chain, they reduce to the traditional Baum-Welch re-estimation 
equations. 
E-step 
Unfortunately, as in the simpler CVQ, the exact E-step for factorial HMMs is com- 
putationally intractable. For example, the expectation of the jth unit in vector i at 
time step t, given {y), is: 
(sj)c = P(sj = 11{y),) 
k 
t __ 
- 1,... ,s2 -- 1,..., sa,2,,- ll{y}, 
jl ,...,jhi,...,ja 
Although the Markov property can be used to obtain a forward-backward-like fac- 
torization of this expectation across time steps, the sum over all possible configura- 
tions of the other hidden units within each time step is unavoidable. For a data set 
4 76 Z. GHAHRAMANI, M. I. JORDAN 
of N sequences of length T, the full E-ste
